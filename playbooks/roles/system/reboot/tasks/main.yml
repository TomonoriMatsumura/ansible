- name: システムを再起動する
  sudo: yes
  command: /sbin/shutdown -r
  async: 0
  poll: 0
  ignore_errors: true

- name: waiting for server to come back
  sudo: no
  local_action: wait_for
  args:
    host: "{{ inventory_hostname }}"
    state: started
###    port: 22
###    delay: 30 
###    timeout: 300
### ディレイやタイムアウトを設定してもさくらVPSだとうまく行かない
### 時間が4分ほど余分に掛かるが state=started を利用した方が確実

- name: resister system started date time for debug
  sudo: yes
  shell: ps -p 1 -o lstart
  register: RESULT

- name: show system started date
  debug: var=RESULT.stdout_lines
  
